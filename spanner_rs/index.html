<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="An asynchronous client for the Cloud Spanner database."><meta name="keywords" content="rust, rustlang, rust-lang, spanner_rs"><title>spanner_rs - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Regular.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../FiraSans-Medium.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Regular.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceSerif4-Bold.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../SourceCodePro-Semibold.ttf.woff2"><link rel="stylesheet" href="../normalize.css"><link rel="stylesheet" href="../rustdoc.css" id="mainThemeStyle"><link rel="stylesheet" href="../ayu.css" disabled><link rel="stylesheet" href="../dark.css" disabled><link rel="stylesheet" href="../light.css" id="themeStyle"><script id="default-settings" ></script><script src="../storage.js"></script><script defer src="../crates.js"></script><script defer src="../main.js"></script><noscript><link rel="stylesheet" href="../noscript.css"></noscript><link rel="alternate icon" type="image/png" href="../favicon-16x16.png"><link rel="alternate icon" type="image/png" href="../favicon-32x32.png"><link rel="icon" type="image/svg+xml" href="../favicon.svg"></head><body class="rustdoc mod crate"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="sidebar-logo" href="../spanner_rs/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div></a><h2></h2></nav><nav class="sidebar"><a class="sidebar-logo" href="../spanner_rs/index.html"><div class="logo-container"><img class="rust-logo" src="../rust-logo.svg" alt="logo"></div></a><h2 class="location"><a href="#">Crate spanner_rs</a></h2><div class="sidebar-elems"><ul class="block"><li class="version">Version 0.3.0</li><li><a id="all-types" href="all.html">All Items</a></li></ul><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li><li><a href="#traits">Traits</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><div class="search-container"><span></span><input class="search-input" name="search" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../wheel.svg"></a></div></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1 class="fqn">Crate <a class="mod" href="#">spanner_rs</a><button id="copy-path" onclick="copy_path(this)" title="Copy item path to clipboard"><img src="../clipboard.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../src/spanner_rs/lib.rs.html#1-134">source</a> · <a id="toggle-all-docs" href="javascript:void(0)" title="collapse all docs">[<span class="inner">&#x2212;</span>]</a></span></div><details class="rustdoc-toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>An asynchronous client for the Cloud Spanner database.</p>
<h2 id="example"><a href="#example">Example</a></h2>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="kw">use </span>spanner_rs::{Client, Error, ReadContext, TransactionContext};

<span class="attribute">#[tokio::main]
</span><span class="kw">async fn </span>main() -&gt; <span class="prelude-ty">Result</span>&lt;(), Error&gt; {
    <span class="kw">let </span><span class="kw-2">mut </span>client = Client::configure()
        .project(<span class="string">&quot;my-gcp-project&quot;</span>)
        .instance(<span class="string">&quot;my-instance&quot;</span>)
        .database(<span class="string">&quot;my-database&quot;</span>)
        .connect()
        .<span class="kw">await</span><span class="question-mark">?</span>;

    <span class="comment">// assuming the following table:
    //   person(id INT64, name STRING(MAX), data BYTES(MAX))
    </span>client
        .read_write()
        .run(|tx| {
            tx.execute_update(
                <span class="string">&quot;INSERT INTO person(id, name, data) VALUES(@id, @name, NULL)&quot;</span>,
                <span class="kw-2">&amp;</span>[(<span class="string">&quot;id&quot;</span>, <span class="kw-2">&amp;</span><span class="number">42</span>), (<span class="string">&quot;name&quot;</span>, <span class="kw-2">&amp;</span><span class="string">&quot;ferris&quot;</span>)],
            )
        })
        .<span class="kw">await</span><span class="question-mark">?</span>;

    <span class="kw">let </span>result_set = client
        .read_only()
        .execute_query(<span class="string">&quot;SELECT * FROM person&quot;</span>, <span class="kw-2">&amp;</span>[])
        .<span class="kw">await</span><span class="question-mark">?</span>;

    <span class="kw">for </span>row <span class="kw">in </span>result_set.iter() {
        <span class="kw">let </span>id: u32 = row.get(<span class="string">&quot;id&quot;</span>)<span class="question-mark">?</span>;
        <span class="kw">let </span>name: <span class="kw-2">&amp;</span>str = row.get(<span class="string">&quot;name&quot;</span>)<span class="question-mark">?</span>;
        <span class="kw">let </span>data: <span class="prelude-ty">Option</span>&lt;<span class="kw-2">&amp;</span>[u8]&gt; = row.get(<span class="string">&quot;data&quot;</span>)<span class="question-mark">?</span>;

        <span class="macro">println!</span>(<span class="string">&quot;found person: {} {} {:?}&quot;</span>, id, name, data);
    }

    <span class="prelude-val">Ok</span>(())
}</code></pre></div>
<h2 id="transactions"><a href="#transactions">Transactions</a></h2>
<p>Cloud Spanner <a href="https://cloud.google.com/spanner/docs/transactions">supports</a> several transaction “modes”:</p>
<ul>
<li>read-only: provides guaranteed consistency between several reads, cannot write;</li>
<li>read-write: the only way to write into Cloud Spanner they use a combination of locking and retries and are typically more expensive;</li>
<li>partitioned DML: these are unsupported by this client at the moment.</li>
</ul>
<h3 id="read-only"><a href="#read-only">Read Only</a></h3>
<p>Reads are done within “single-use” transactions and can be bounded to determine what data is visible to them, see <a href="enum.TimestampBound.html" title="TimestampBound"><code>TimestampBound</code></a>.
Reading is done using <a href="trait.ReadContext.html" title="ReadContext"><code>ReadContext</code></a> which can be obtained using <a href="struct.Client.html#method.read_only" title="Client::read_only()"><code>Client::read_only()</code></a> or <a href="struct.Client.html#method.read_only_with_bound" title="Client::read_only_with_bound()"><code>Client::read_only_with_bound()</code></a>.</p>
<p>Example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attribute">#[tokio::main]
</span><span class="kw">let </span>result_set = client
    .read_only()
    .execute_query(<span class="string">&quot;SELECT COUNT(*) AS people FROM person&quot;</span>, <span class="kw-2">&amp;</span>[])
    .<span class="kw">await</span><span class="question-mark">?</span>;
<span class="kw">let </span>people: u32 = result_set.iter().next().unwrap().get(<span class="string">&quot;people&quot;</span>)<span class="question-mark">?</span>;</code></pre></div>
<h3 id="read-write"><a href="#read-write">Read Write</a></h3>
<p>Read / write transactions are done through <a href="trait.TransactionContext.html" title="TransactionContext"><code>TransactionContext</code></a> which extends <a href="trait.ReadContext.html" title="ReadContext"><code>ReadContext</code></a> to allow writes.
When a transaction that conflicts with another tries to commit, Cloud Spanner will reject one of them let the client know it may retry.
This client encapsulates the necessary retry logic such that applications do not need to implement it themselves.</p>
<p>Example:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="attribute">#[tokio::main]
</span>client
    .read_write()
    .run(|tx| {
        <span class="comment">// this closure may be invoked more than once
        </span>Box::pin(<span class="kw">async move </span>{
            <span class="comment">// read
            </span><span class="kw">let </span>rs = tx.execute_query(<span class="string">&quot;...&quot;</span>, <span class="kw-2">&amp;</span>[]).<span class="kw">await</span><span class="question-mark">?</span>;
            <span class="comment">// write
            </span>tx.execute_update(<span class="string">&quot;...&quot;</span>, <span class="kw-2">&amp;</span>[]).<span class="kw">await</span><span class="question-mark">?</span>;
            <span class="prelude-val">Ok</span>(())
        })
    })
    .<span class="kw">await</span><span class="question-mark">?</span>;</code></pre></div>
<h3 id="authentication"><a href="#authentication">Authentication</a></h3>
<p>Authentication uses the [<code>gcp_auth</code>] crate which supports several authentication methods.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Client.html" title="spanner_rs::Client struct">Client</a></div><div class="item-right docblock-short">An asynchronous Cloud Spanner client.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Config.html" title="spanner_rs::Config struct">Config</a></div><div class="item-right docblock-short">Configuration for building a <a href="struct.Client.html" title="Client"><code>Client</code></a>.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ConfigBuilder.html" title="spanner_rs::ConfigBuilder struct">ConfigBuilder</a></div><div class="item-right docblock-short">Builder for <a href="struct.Config.html"><code>Config</code></a>.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.DatabaseId.html" title="spanner_rs::DatabaseId struct">DatabaseId</a></div><div class="item-right docblock-short">The resource that identifies a Cloud Spanner database in a particular Cloud Spanner instance.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.InstanceId.html" title="spanner_rs::InstanceId struct">InstanceId</a></div><div class="item-right docblock-short">The resource that identifies a Cloud Spanner instance in a particular GCP project.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ProjectId.html" title="spanner_rs::ProjectId struct">ProjectId</a></div><div class="item-right docblock-short">The resource that identifies a particular GCP project.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.ResultSet.html" title="spanner_rs::ResultSet struct">ResultSet</a></div><div class="item-right docblock-short">A result set is returned by Cloud Spanner when executing SQL queries.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Row.html" title="spanner_rs::Row struct">Row</a></div><div class="item-right docblock-short">A row of a result set returned by Cloud Spanner.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SessionPoolConfig.html" title="spanner_rs::SessionPoolConfig struct">SessionPoolConfig</a></div><div class="item-right docblock-short">Configuration for the internal Cloud Spanner session pool.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.SessionPoolConfigBuilder.html" title="spanner_rs::SessionPoolConfigBuilder struct">SessionPoolConfigBuilder</a></div><div class="item-right docblock-short">Builder for <a href="struct.SessionPoolConfig.html"><code>SessionPoolConfig</code></a>.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Statement.html" title="spanner_rs::Statement struct">Statement</a></div><div class="item-right docblock-short">A single DML statement that can be used in a batch of DML statements using <a href="trait.TransactionContext.html#tymethod.execute_updates" title="TransactionContext::execute_updates"><code>TransactionContext::execute_updates</code></a></div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.Struct.html" title="spanner_rs::Struct struct">Struct</a></div><div class="item-right docblock-short">The Cloud Spanner value for the <a href="https://cloud.google.com/spanner/docs/data-types#struct_type"><code>Struct</code></a> type.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.StructType.html" title="spanner_rs::StructType struct">StructType</a></div><div class="item-right docblock-short">The Cloud Spanner <a href="https://cloud.google.com/spanner/docs/data-types#struct_type"><code>Struct</code></a> type which is composed of optionally named fields and their data type.</div></div><div class="item-row"><div class="item-left module-item"><a class="struct" href="struct.TxRunner.html" title="spanner_rs::TxRunner struct">TxRunner</a></div><div class="item-right docblock-short">Allows running read/write transactions against Cloud Spanner.</div></div></div><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Error.html" title="spanner_rs::Error enum">Error</a></div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.TimestampBound.html" title="spanner_rs::TimestampBound enum">TimestampBound</a></div><div class="item-right docblock-short">Specifies the bounds withing wich to make reads in Spanner.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Type.html" title="spanner_rs::Type enum">Type</a></div><div class="item-right docblock-short">An enumeration of all Cloud Spanner <a href="https://cloud.google.com/spanner/docs/data-types">data types</a>.</div></div><div class="item-row"><div class="item-left module-item"><a class="enum" href="enum.Value.html" title="spanner_rs::Value enum">Value</a></div><div class="item-right docblock-short">An enumeration of the Cloud Spanner values for each supported data type.</div></div></div><h2 id="traits" class="small-section-header"><a href="#traits">Traits</a></h2><div class="item-table"><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.FromSpanner.html" title="spanner_rs::FromSpanner trait">FromSpanner</a></div><div class="item-right docblock-short">A trait for Rust types that can be converted from Cloud Spanner values.</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.ReadContext.html" title="spanner_rs::ReadContext trait">ReadContext</a></div><div class="item-right docblock-short">Defines the interface to read data out of Cloud Spanner.</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.RowIndex.html" title="spanner_rs::RowIndex trait">RowIndex</a></div><div class="item-right docblock-short">A trait implemented by types that can index into a row.</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.SpannerResource.html" title="spanner_rs::SpannerResource trait">SpannerResource</a></div><div class="item-right docblock-short">A trait for identifiable resources within Cloud Spanner.</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.ToSpanner.html" title="spanner_rs::ToSpanner trait">ToSpanner</a></div><div class="item-right docblock-short">A trait for Rust types that can be converted to Cloud Spanner values.</div></div><div class="item-row"><div class="item-left module-item"><a class="trait" href="trait.TransactionContext.html" title="spanner_rs::TransactionContext trait">TransactionContext</a></div><div class="item-right docblock-short">Defines the interface to read from and write into Cloud Spanner.</div></div></div></section></div></main><div id="rustdoc-vars" data-root-path="../" data-current-crate="spanner_rs" data-themes="ayu,dark,light" data-resource-suffix="" data-rustdoc-version="1.66.0-nightly (7fcf850d7 2022-10-23)" ></div></body></html>